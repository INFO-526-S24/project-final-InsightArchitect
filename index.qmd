---
title: "Global Poverty Trends: A Comprehensive Dataset for Research and Development"
subtitle: "INFO 526 - Project Final"
author: 
  - name: "InsightArchitect - Ayesha, Shreemithra, Anusha, Eeshaan, Kaarthik, Amaan"
    affiliations:
      - name: "School of Information, University of Arizona"
description: "Project description"
format:
   html:
    code-tools: true
    code-overflow: wrap
    embed-resources: true
editor: visual
execute:
  warning: false
  echo: false
---

## Abstract

<<<<<<< HEAD
Add project abstract here.

------------------------------------------------------------------------
=======
## Introduction

```{r}
#| label: load-pkgs
#| message: false
#| echo: false
#| warning: false
library(tidyverse,
        png)
library(ggplot2)
library(dplyr)
library(scales)  
library(tidyr)
#install.packages("gganimate")
#install.packages("globe4r")
#install.packages("remotes")
library(gganimate)

```

```{r}
#| label: load-dataset
#| message: false
#| warning: false
#| echo: false
pip_row_data <- read.csv('data/pip_dataset.csv')
ex_pro_data <- read.csv('data/globalextremepovertyrate_world-bank2020.csv')
```

## Justification of approach

## Questions 01: Who is Conquering Extreme Poverty in Various Global Regions Across Time? How does the distribution of wealth differ among various income groups?

### Plot 01 : Stacked Bar Chart to know Poverty Trends over the year in the World

#### **Dependency Columns:**

For Plot 01 dependent columns are `"Number.of.people.living.in.extreme.poverty"`, `"Number.of.people.not.living.in.extreme.poverty"` & `"year"`

```{r}
#| label: stacked-bar-chart
#| message: false
#| warning: false
#| echo: false

# Filter the data to include only specified years
years_to_include <- c(1820, 
                      1850, 
                      1870, 
                      1890, 
                      1910, 
                      1929, 
                      1950, 
                      1960, 
                      1970, 
                      1980:2017)
ex_pro_data_filtered <- ex_pro_data %>%
  filter(Year %in% years_to_include) %>%
  mutate(Year = factor(Year, 
                       levels = years_to_include))  

# Transform data for plotting in a long format suitable for ggplot2
ex_pro_data_long <- pivot_longer(
  ex_pro_data_filtered,
  cols = c( "Number.of.people.living.in.extreme.poverty", 
            "Number.of.people.not.living.in.extreme.poverty"),
  names_to = "Status",
  values_to = "Count"
) %>%
    mutate(Count = Count / 1e9,  
         Status = recode(Status,
                         "Number.of.people.living.in.extreme.poverty" = "Population Live In Extreme Poverty",
                         "Number.of.people.not.living.in.extreme.poverty" = "Population Live Not in Extreme Poverty"))

# Stacked Bar Chart with counts on bars
stacked_absolute_bar_chart <- ggplot(ex_pro_data_long, 
                                     aes(x = Year, 
                                         y = Count, 
                                         fill = Status)) +
  geom_bar(stat = "identity") +
  geom_text(
    aes(label = scales::comma(Count, 
                              accuracy = 0.1), 
        group = Status),
    position = position_stack(vjust = 0.5),  
    color = "black",  
    size = 4  
  ) +
  labs(title = "Polulation Living in Extreme Poverty Level Around the World",
       subtitle = "Year: (1820-2017)",
        caption ="Data source: Ravallion (2016) updated with World Bank (2019) \nLink: OurWorldInData.org/poverty",
       x = "Year", 
       y = "Number of Population (Billions)",
       fill = "Status") +
  theme_minimal() +
  theme(legend.position = "bottom",
         plot.title = element_text(size = 20, 
                              face = "bold", 
                              hjust = 0.5),
         plot.subtitle = element_text(size = 18, 
                                 face = "bold", 
                                 hjust = 0.5),
         plot.caption = element_text(size = 10, 
                                 hjust = 1))  

# save the plots
ggsave("images/stacked_absolute_bar_chart.png", 
       stacked_absolute_bar_chart, 
       width = 17, 
       height = 8, 
       bg="white")

# Animated Plot
animated_plot <- stacked_absolute_bar_chart +
  transition_layers(
    layer_length = 1,    
    transition_length = 2,  
    keep_layers = TRUE  
  ) +
  enter_fade() +         
  enter_drift(x_mod = 1, y_mod = -1) +  
  exit_fade() +          
  ease_aes('linear')    

# Render the animation
#anim_save("images/animated_stacked_bar_chart02.gif", 
#          animated_plot, 
#          width = 1100, 
#          height = 600, 
#         fps = 10, 
#          duration = 15)
```

<img src="images/animated_stacked_bar_chart02.gif" alt="Stacked Bar Chart of Population by Poverty Status" width="100%"/>

**Visualization Descriptions:**

The global population's historical data, from 1820 to 2017, is visualized as a bar chart that shows those living in and out of extreme poverty. It displays two segments: those living in extreme poverty are indicated in the top segment `(shown in red)`, while the people not living in extreme poverty is represented in the bottom segment `(shown in blue`). The blue segment shows a clear increase over time, indicating a decrease in extreme poverty rates and an increase in the population living above the poverty line. On the other hand, there is a good tendency toward the reduction of poverty as the red segment diminishes, which is particularly evident after 1980. The population counts in billions are provided by the text labels on each bar segment. The referenced data source, Ravallion (2016), has been updated with additional information including World Bank (2019) data.

### Plot 02 : Distribution of Wealth Inequality Across Different Income Groups

#### **Dependency Columns:**

For Plot 02 dependent columns are `"gini"`, `"palma_ratio"`, `"s80_s20_ratio"`, `"p90_p10_ratio"`, `"p90_p50_ratio"`, `"p50_p10_ratio"` and `"mld"`

```{r}
#| label: 3D Illustration
#| message: false
#| warning: false
#| echo: false

library(ggplot2)
library(ggridges) 
library(dplyr)
library(viridis)  

# Transforming the data into a long format suitable for ridge plots
pip_data_long <- pip_row_data %>%
  pivot_longer(
    cols = c("gini", 
             "palma_ratio", 
             "s80_s20_ratio", 
             "p90_p10_ratio", 
             "p90_p50_ratio", 
             "p50_p10_ratio", 
             "mld"),
    names_to = "Inequality_Metric",
    values_to = "Metric_Value"
  ) %>%
  mutate(Inequality_Metric = recode(Inequality_Metric,
                                    "gini" = "National Income Inequality",
                                    "palma_ratio" = "Wealth Disparity Ratio",
                                    "s80_s20_ratio" = "Richest-poorest Income Ratio",
                                    "p90_p10_ratio" = "Richest-Poorest Gap Ratio",
                                    "p90_p50_ratio" = "Top-Middle Gap Ratio",
                                    "p50_p10_ratio" = "Middle-Poorest Gap Ratio",
                                    "mld" = "Inequality Level Measure"))


# Plotting the ridge plot with a gradient effect using geom_density_ridges_gradient
ridge_plot <- ggplot(pip_data_long, 
                     aes(x = Metric_Value, 
                         y = Inequality_Metric, 
                         fill = ..x..)) +
  geom_density_ridges_gradient(
    scale = 10,
    rel_min_height = 0.01,
    gradient_lwd = 1.
  ) +
  scale_fill_viridis_c(
    name = "Intencity", 
    option = "C"
  ) +
  labs(
    title = "Distribution of Wealth Inequality Across Different Income Groups",
    subtitle = "3D Illustration : Seven Different Metrics", 
    x = "Metric Value of Distribution",
    y = "Inequality Metric of Wealth Disparity",
    fill = "Intencity"
  ) +
  theme_ridges(font_size = 12, 
               grid = TRUE) +
  theme(
    plot.title = element_text(size = 16, 
                              face = "bold", 
                              hjust = 0.5),
    plot.subtitle  = element_text(size = 16, 
                                  hjust = 0.5),
    axis.title.x = element_text(size = 12, 
                                face = "bold", 
                                hjust = 0.5), 
    axis.title.y = element_text(size = 12, 
                                face = "bold", 
                                hjust = 0.5),
    legend.position = "right"
  ) +
  scale_x_continuous(
    limits = c(-2, 
               10),  
    breaks = seq(0, 
                 10, 
                 1)
  )

# Save the plot
ggsave("images/3D_ridge_plot.png", 
       ridge_plot, 
       width = 12, 
       height = 7, 
       bg = "white")

```

<img src="images/3D_ridge_plot.png" alt="Distribution of Wealth Inequality Across Different Income Groups" width="100%"/>

#### Visualization Descriptions:

Less inequality is often suggested by higher values in the context of metrics such as the `Gini coefficient`, `Palma ratio`, or `S80/S20 ratio`, whereas more inequality is often suggested by lower values.

**Darker hues:** approaching the color purple, would symbolize a more equitable distribution, where income is dispersed more equally among the populace.

**Brighter hues:** which resemble yellow more closely, would be indicative of greater inequality and wealth concentration in a smaller number of hands. As an illustration, a country's level of inequality would be shown by a `Gini coefficient` that is closer to 0 (darker colors) or closer to 1 (brighter colors). In the same way, lower values for the `Palma` and `S80/S20 ratios` would indicate a narrower gap between the wealthiest and poorest groups in society.

## Discussion

## References

\[1\] Source Data link : [*https://ourworldindata.org/grapher/world-population-in-extreme-poverty-absolute?time=earliest..2015*](https://ourworldindata.org/grapher/world-population-in-extreme-poverty-absolute?time=earliest..2015)

\[2\] Used Generative AI to know the solutions of the errors link: <https://chat.openai.com/>

\[3\] Used some techniques an codes from class lectures ppt file, Link: <https://datavizaz.org/>\
>>>>>>> 43ab70d112a204beff77587ca92de9f36bfe2929


## Question 2

```{r}

## Implement Shiny (sample)
# Define UI
#ui <- fluidPage(
 # titlePanel("Globe4r in Shiny"),
  #sidebarLayout(
   # sidebarPanel(
    #  sliderInput("magnitude", "Minimum Magnitude", min = 0, max = 6, value = 4.5)
  #  ),
  #  mainPanel(
   #   globeOutput("earthquakeGlobe")
  #  )
#  )
#)

# Define server logic
#server <- function(input, output) {
 # output$earthquakeGlobe <- renderGlobe({
    # Filter quakes based on the magnitude input
  #  filtered_quakes <- quakes[quakes$mag > input$magnitude, ]
    
   # create_globe() %>%
    #  globe_pov(-21, 179) %>%
     # globe_bars(
      #  coords(lat, long, mag), 
       # data = filtered_quakes,
        #color = "red"
    #  )
  #})
#}
```

```{r}
# running the UI
#shinyApp(ui = ui, server = server)
library(ggplot2)
library(sf)
library(dplyr)
library(rnaturalearth)
library(rnaturalearthdata)
# Read the CSV file into a data frame
my_data <- read.csv("data/pip_dataset.csv")
country_lat_long <- read.csv("data/country_pin.csv")
```

```{r}
# Load country shapes
world <- ne_countries(scale = "medium", returnclass = "sf")

# Prepare your data
# Assuming 'my_data' is already loaded and contains the necessary metrics
# Filter data for the year 2006
my_data_2006 <- my_data %>%
  filter(year == 2006) %>%
  group_by(country) %>%
  summarise(avg_gini = mean(gini, na.rm = TRUE)) # Replace 'gini' with your metric, ensure the name matches your column

# Merge with spatial data
world_data <- world %>%
  left_join(my_data_2006, by = c("name" = "country"))

# Plot
ggplot(data = world_data) +
  geom_sf(aes(fill = avg_gini), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey", name = "Avg Gini Index") +
  labs(title = "Average Gini Index by Country for the Year 2006", 
       subtitle = "Data aggregated from individual records") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
# Load country shapes
world <- ne_countries(scale = "medium", returnclass = "sf")

# Prepare your data
# Assuming 'my_data' is already loaded and contains the necessary metrics
# Filter data for the year 2000 and for headcount_ratio_international_povline
my_data_2000 <- my_data %>%
  filter(year == 2006) %>%
  group_by(country) %>%
  summarise(headcount_int_povline = mean(headcount_ratio_international_povline, na.rm = TRUE))

# Merge with spatial data
world_data <- world %>%
  left_join(my_data_2000, by = c("name" = "country"))

# Plot
ggplot(data = world_data) +
  geom_sf(aes(fill = headcount_int_povline), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey", name = "Headcount Ratio Intl. Pov. Line") +
  labs(title = "Headcount Ratio at International Poverty Line by Country for the Year 2000", 
       subtitle = "Data aggregated from individual records") +
  theme_minimal() +
  theme(legend.position = "bottom")

```
```{r}

# Load country shapes from Natural Earth
world <- ne_countries(scale = "medium", returnclass = "sf")

# Assuming 'my_data' is already loaded and contains the necessary metrics
# Filter data for the year 2000 and for income_gap_ratio_international_povline
my_data_2000 <- my_data %>%
  filter(year == 2006) %>%
  group_by(country) %>%
  summarise(income_gap_int_povline = mean(income_gap_ratio_international_povline, na.rm = TRUE))

# Merge with spatial data
world_data <- world %>%
  left_join(my_data_2000, by = c("name" = "country"))

# Plot
ggplot(data = world_data) +
  geom_sf(aes(fill = income_gap_int_povline), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey", name = "Income Gap Ratio Intl. Pov. Line") +
  labs(title = "Income Gap Ratio at International Poverty Line by Country for the Year 2000", 
       subtitle = "Data aggregated from individual records") +
  theme_minimal() +
  theme(legend.position = "bottom")

```

```{r}

# Join and select necessary columns
#my_data_with_coords <- my_data %>%
#  left_join(country_lat_long, by = "country") %>%
  #rename(country_lat = latitude, country_long = longitude) %>%
 # select(names(my_data), country_lat, country_long)

# Manually creating the data based on the provided row
#data_2000 <- data.frame(
 # country = "Angola",
#  year = 2000,
  #reporting_level = "national",
 # welfare_type = "consumption",
#  ppp_version = 2011,
  #survey_year = 2000.21,
 # survey_comparability = 0,
#  headcount_international_povline = 5963769,
 # country_lat = -21,   # Fixed latitude for Angola
#  country_long = 179  # Fixed longitude for Angola
#)

# Scaling the headcount_international_povline for visualization
# This scaling factor is arbitrary and may need adjustment based on your full dataset
#data_2000$altitude_scaled <- data_2000$headcount_international_povline / 1e6  # Scaling down for visualization

# Visualization with globe4r
#create_globe() %>% 
#  globe_pov(-11.2027, 17.8739) %>%  # Centering on Angola
#  globe_bars(
  #  coords(
    #  lat = country_lat,
     # long = country_long,
    #  altitude = altitude_scaled,  # Using the scaled headcount value
   #   color = altitude_scaled,  # Coloring based on the scaled value
  #    label = country  # Label with the country name
 #   ), 
#    data = data_2000
#  ) %>% 
  #scale_bars_color() %>%
 # scale_bars_altitude()

#data_2000

```

```{r}
create_globe() %>% 
  globe_pov(-21, 179) %>% # position camera
  globe_bars(
    coords(country_lat, country_long), 
    data = data_2000
  )
```

